2025-10-16 16:24:23 - [INFO] - Logger cho 'MoritzLaurer_ernie-m-large-mnli-xnli-training' ƒë√£ ƒë∆∞·ª£c kh·ªüi t·∫°o. File log: logs/MoritzLaurer_ernie-m-large-mnli-xnli-training/2025-10-16_16-24-23.log
2025-10-16 16:24:23 - [INFO] - Logger initialized for MoritzLaurer/ernie-m-large-mnli-xnli
2025-10-16 16:24:23 - [INFO] - ============================================================
2025-10-16 16:24:23 - [INFO] - üöÄ STARTING TRAINING SESSION
2025-10-16 16:24:23 - [INFO] - ============================================================
2025-10-16 16:24:23 - [INFO] - ROOT_DIR: /home/guest/Projects/CS221
2025-10-16 16:24:23 - [INFO] - DATA_DIR: /home/guest/Projects/CS221/data
2025-10-16 16:24:23 - [INFO] - TRAIN_FILE: /home/guest/Projects/CS221/data/vihallu-train.csv
2025-10-16 16:24:23 - [INFO] - TEST_FILE: /home/guest/Projects/CS221/data/vihallu-public-test.csv
2025-10-16 16:24:23 - [INFO] - SUBMISSION_DIR: /home/guest/Projects/CS221/submission
2025-10-16 16:24:23 - [INFO] - SUBMISSION_CSV: submit.csv
2025-10-16 16:24:23 - [INFO] - SUBMISSION_ZIP: submit.zip
2025-10-16 16:24:23 - [INFO] - MODEL_NAME: MoritzLaurer/ernie-m-large-mnli-xnli
2025-10-16 16:24:23 - [INFO] - MODEL_OUTPUT_DIR: /home/guest/Projects/CS221/models/ernie-m-large-mnli-xnli-tuned
2025-10-16 16:24:23 - [INFO] - MAX_LENGTH: 512
2025-10-16 16:24:23 - [INFO] - RANDOM_STATE: 42
2025-10-16 16:24:23 - [INFO] - EPOCHS: 10
2025-10-16 16:24:23 - [INFO] - BATCH_SIZE: 2
2025-10-16 16:24:23 - [INFO] - GRADIENT_ACCUMULATION_STEPS: 8
2025-10-16 16:24:23 - [INFO] - SCHEDULER_TYPE: linear
2025-10-16 16:24:23 - [INFO] - LEARNING_RATE: 6e-06
2025-10-16 16:24:23 - [INFO] - WEIGHT_DECAY: 0.03
2025-10-16 16:24:23 - [INFO] - CLASSIFIER_DROPOUT: 0.02
2025-10-16 16:24:23 - [INFO] - EPSILON: 1e-08
2025-10-16 16:24:23 - [INFO] - PATIENCE_LIMIT: 2
2025-10-16 16:24:23 - [INFO] - TOTAL_STEP_SCALE: 0.1
2025-10-16 16:24:23 - [INFO] - LABEL_SMOOTHING: 0.05
2025-10-16 16:24:23 - [INFO] - VALIDATION_SPLIT_SIZE: 0.2
2025-10-16 16:24:23 - [INFO] - LABEL_MAP: {'intrinsic': 0, 'extrinsic': 1, 'no': 2}
2025-10-16 16:24:23 - [INFO] - ID2LABEL: {0: 'intrinsic', 1: 'extrinsic', 2: 'no'}
2025-10-16 16:24:23 - [INFO] - CLASS_WEIGHTS: [1.0393466963622866, 1.0114145354717525, 0.9531590413943355]
2025-10-16 16:24:23 - [INFO] - ============================================================
2025-10-16 16:24:26 - [INFO] - B·∫Øt ƒë·∫ßu pipeline hu·∫•n luy·ªán.
2025-10-16 16:24:26 - [INFO] - B∆∞·ªõc 1: Chu·∫©n b·ªã d·ªØ li·ªáu...
2025-10-16 16:24:26 - [INFO] - Chia d·ªØ li·ªáu: 5600 m·∫´u train, 1400 m·∫´u validation.
2025-10-16 16:24:26 - [INFO] - B∆∞·ªõc 2: T·∫£i model 'MoritzLaurer/ernie-m-large-mnli-xnli' v√† tokenizer...
2025-10-16 16:24:28 - [INFO] - Ph√¢n t√≠ch ki·∫øn tr√∫c m√¥ h√¨nh b·∫±ng torchinfo...
2025-10-16 16:24:30 - [INFO] - Ki·∫øn tr√∫c chi ti·∫øt c·ªßa m√¥ h√¨nh:
================================================================================================================================================================
Layer (type:depth-idx)                                       Input Shape               Output Shape              Param #                   Mult-Adds
================================================================================================================================================================
ErnieMForSequenceClassification                              --                        [2, 3]                    --                        --
‚îú‚îÄErnieMModel: 1-1                                           [2, 512]                  [2, 1024]                 --                        --
‚îÇ    ‚îî‚îÄErnieMEmbeddings: 2-1                                 --                        [2, 512, 1024]            --                        --
‚îÇ    ‚îÇ    ‚îî‚îÄEmbedding: 3-1                                   [2, 512]                  [2, 512, 1024]            256,002,048               512,004,096
‚îÇ    ‚îÇ    ‚îî‚îÄEmbedding: 3-2                                   [2, 512]                  [2, 512, 1024]            526,336                   1,052,672
‚îÇ    ‚îÇ    ‚îî‚îÄLayerNorm: 3-3                                   [2, 512, 1024]            [2, 512, 1024]            2,048                     4,096
‚îÇ    ‚îÇ    ‚îî‚îÄDropout: 3-4                                     [2, 512, 1024]            [2, 512, 1024]            --                        --
‚îÇ    ‚îî‚îÄErnieMEncoder: 2-2                                    [2, 512, 1024]            [2, 512, 1024]            --                        --
‚îÇ    ‚îÇ    ‚îî‚îÄModuleList: 3-5                                  --                        --                        302,309,376               --
‚îÇ    ‚îî‚îÄErnieMPooler: 2-3                                     [2, 512, 1024]            [2, 1024]                 --                        --
‚îÇ    ‚îÇ    ‚îî‚îÄLinear: 3-6                                      [2, 1024]                 [2, 1024]                 1,049,600                 2,099,200
‚îÇ    ‚îÇ    ‚îî‚îÄTanh: 3-7                                        [2, 1024]                 [2, 1024]                 --                        --
‚îú‚îÄDropout: 1-2                                               [2, 1024]                 [2, 1024]                 --                        --
‚îú‚îÄLinear: 1-3                                                [2, 1024]                 [2, 3]                    3,075                     6,150
================================================================================================================================================================
Total params: 559,892,483
Trainable params: 559,892,483
Non-trainable params: 0
Total mult-adds (Units.GIGABYTES): 1.12
================================================================================================================================================================
Input size (MB): 0.01
Forward/backward pass size (MB): 2239.77
Params size (MB): 2239.57
Estimated Total Size (MB): 4479.35
================================================================================================================================================================
2025-10-16 16:24:30 - [INFO] - B∆∞·ªõc 3: T·∫°o Dataset v√† DataLoader v·ªõi Custom Collate Function...
2025-10-16 16:24:30 - [INFO] - ‚úÖ T·∫°o DataLoader v·ªõi Dynamic Padding t√πy ch·ªânh th√†nh c√¥ng!
2025-10-16 16:24:30 - [INFO] - Gradient accumulation steps: 8 | Effective batch size: 16
2025-10-16 16:24:30 - [INFO] - B∆∞·ªõc 4: Thi·∫øt l·∫≠p m√¥i tr∆∞·ªùng hu·∫•n luy·ªán v√† ki·∫øn tr√∫c model...
2025-10-16 16:24:30 - [INFO] - S·ª≠ d·ª•ng thi·∫øt b·ªã: cuda
2025-10-16 16:24:30 - [INFO] - ‚úÖ T√¨m th·∫•y 1 GPU(s).
2025-10-16 16:24:30 - [INFO] - ‚úÖ ƒêang s·ª≠ d·ª•ng GPU: NVIDIA GeForce RTX 5070 Ti
2025-10-16 16:24:30 - [INFO] - Ki·∫øn tr√∫c c·ªßa m√¥ h√¨nh:
ErnieMForSequenceClassification(
  (ernie_m): ErnieMModel(
    (embeddings): ErnieMEmbeddings(
      (word_embeddings): Embedding(250002, 1024, padding_idx=1)
      (position_embeddings): Embedding(514, 1024, padding_idx=1)
      (layer_norm): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
      (dropout): Dropout(p=0.02, inplace=False)
    )
    (encoder): ErnieMEncoder(
      (layers): ModuleList(
        (0-23): 24 x ErnieMEncoderLayer(
          (self_attn): ErnieMAttention(
            (self_attn): ErnieMSelfAttention(
              (q_proj): Linear(in_features=1024, out_features=1024, bias=True)
              (k_proj): Linear(in_features=1024, out_features=1024, bias=True)
              (v_proj): Linear(in_features=1024, out_features=1024, bias=True)
              (dropout): Dropout(p=0.02, inplace=False)
            )
            (out_proj): Linear(in_features=1024, out_features=1024, bias=True)
          )
          (linear1): Linear(in_features=1024, out_features=4096, bias=True)
          (dropout): Dropout(p=0.02, inplace=False)
          (linear2): Linear(in_features=4096, out_features=1024, bias=True)
          (norm1): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
          (norm2): LayerNorm((1024,), eps=1e-05, elementwise_affine=True)
          (dropout1): Dropout(p=0.02, inplace=False)
          (dropout2): Dropout(p=0.02, inplace=False)
          (activation): GELUActivation()
        )
      )
    )
    (pooler): ErnieMPooler(
      (dense): Linear(in_features=1024, out_features=1024, bias=True)
      (activation): Tanh()
    )
  )
  (dropout): Dropout(p=0.02, inplace=False)
  (classifier): Linear(in_features=1024, out_features=3, bias=True)
)
2025-10-16 16:24:30 - [INFO] - Scheduler will run for 3500 total steps (350 per epoch)
2025-10-16 16:24:30 - [INFO] - Warmup steps: 350
2025-10-16 16:24:30 - [INFO] - S·ª≠ d·ª•ng Class Weights & Label smoothing cho h√†m loss.
2025-10-16 16:24:30 - [INFO] - --- Epoch 1/10 ---
2025-10-16 16:29:23 - [INFO] - Loss trung b√¨nh tr√™n t·∫≠p train: 1.6256
2025-10-16 16:29:23 - [INFO] - Current Learning Rate: 6.00e-06
2025-10-16 16:29:23 - [INFO] - B·∫Øt ƒë·∫ßu ƒë√°nh gi√° tr√™n t·∫≠p validation...
2025-10-16 16:29:46 - [INFO] - Validation Loss: 0.9126
2025-10-16 16:29:46 - [INFO] - Validation Accuracy: 0.5807
2025-10-16 16:29:46 - [INFO] - Validation Macro-F1: 0.5687
2025-10-16 16:29:46 - [INFO] - Classification Report tr√™n t·∫≠p validation:
              precision    recall  f1-score   support

   intrinsic     0.4729    0.7306    0.5742       490
   extrinsic     0.7020    0.6746    0.6881       461
          no     0.7200    0.3207    0.4438       449

    accuracy                         0.5807      1400
   macro avg     0.6317    0.5753    0.5687      1400
weighted avg     0.6276    0.5807    0.5698      1400

2025-10-16 16:29:46 - [INFO] - üéâ Macro-F1 c·∫£i thi·ªán. ƒêang l∆∞u model t·ªët nh·∫•t v√†o '/home/guest/Projects/CS221/models/ernie-m-large-mnli-xnli-tuned'...
2025-10-16 16:29:49 - [INFO] - L∆∞u model th√†nh c√¥ng.
2025-10-16 16:29:49 - [INFO] - --- Epoch 2/10 ---
2025-10-16 16:34:35 - [INFO] - Loss trung b√¨nh tr√™n t·∫≠p train: 0.7454
2025-10-16 16:34:35 - [INFO] - Current Learning Rate: 5.33e-06
2025-10-16 16:34:35 - [INFO] - B·∫Øt ƒë·∫ßu ƒë√°nh gi√° tr√™n t·∫≠p validation...
2025-10-16 16:34:58 - [INFO] - Validation Loss: 0.6971
2025-10-16 16:34:58 - [INFO] - Validation Accuracy: 0.7479
2025-10-16 16:34:58 - [INFO] - Validation Macro-F1: 0.7491
2025-10-16 16:34:58 - [INFO] - Classification Report tr√™n t·∫≠p validation:
              precision    recall  f1-score   support

   intrinsic     0.7042    0.7143    0.7092       490
   extrinsic     0.7494    0.7332    0.7412       461
          no     0.7942    0.7996    0.7969       449

    accuracy                         0.7479      1400
   macro avg     0.7493    0.7490    0.7491      1400
weighted avg     0.7480    0.7479    0.7479      1400

2025-10-16 16:34:58 - [INFO] - üéâ Macro-F1 c·∫£i thi·ªán. ƒêang l∆∞u model t·ªët nh·∫•t v√†o '/home/guest/Projects/CS221/models/ernie-m-large-mnli-xnli-tuned'...
2025-10-16 16:35:00 - [INFO] - L∆∞u model th√†nh c√¥ng.
2025-10-16 16:35:00 - [INFO] - --- Epoch 3/10 ---
2025-10-16 16:39:46 - [INFO] - Loss trung b√¨nh tr√™n t·∫≠p train: 0.5574
2025-10-16 16:39:46 - [INFO] - Current Learning Rate: 4.67e-06
2025-10-16 16:39:46 - [INFO] - B·∫Øt ƒë·∫ßu ƒë√°nh gi√° tr√™n t·∫≠p validation...
2025-10-16 16:40:09 - [INFO] - Validation Loss: 0.7552
2025-10-16 16:40:09 - [INFO] - Validation Accuracy: 0.7479
2025-10-16 16:40:09 - [INFO] - Validation Macro-F1: 0.7479
2025-10-16 16:40:09 - [INFO] - Classification Report tr√™n t·∫≠p validation:
              precision    recall  f1-score   support

   intrinsic     0.7101    0.7000    0.7050       490
   extrinsic     0.7783    0.7007    0.7374       461
          no     0.7590    0.8486    0.8013       449

    accuracy                         0.7479      1400
   macro avg     0.7491    0.7497    0.7479      1400
weighted avg     0.7482    0.7479    0.7466      1400

2025-10-16 16:40:09 - [WARNING] - Macro-F1 kh√¥ng c·∫£i thi·ªán. Patience: 1/2
2025-10-16 16:40:09 - [INFO] - --- Epoch 4/10 ---
2025-10-16 16:44:55 - [INFO] - Loss trung b√¨nh tr√™n t·∫≠p train: 0.4111
2025-10-16 16:44:55 - [INFO] - Current Learning Rate: 4.00e-06
2025-10-16 16:44:55 - [INFO] - B·∫Øt ƒë·∫ßu ƒë√°nh gi√° tr√™n t·∫≠p validation...
2025-10-16 16:45:18 - [INFO] - Validation Loss: 0.8261
2025-10-16 16:45:18 - [INFO] - Validation Accuracy: 0.7400
2025-10-16 16:45:18 - [INFO] - Validation Macro-F1: 0.7388
2025-10-16 16:45:18 - [INFO] - Classification Report tr√™n t·∫≠p validation:
              precision    recall  f1-score   support

   intrinsic     0.7518    0.6490    0.6966       490
   extrinsic     0.7199    0.7137    0.7168       461
          no     0.7481    0.8664    0.8029       449

    accuracy                         0.7400      1400
   macro avg     0.7399    0.7430    0.7388      1400
weighted avg     0.7401    0.7400    0.7373      1400

2025-10-16 16:45:18 - [WARNING] - Macro-F1 kh√¥ng c·∫£i thi·ªán. Patience: 2/2
2025-10-16 16:45:18 - [INFO] - Early stopping! D·ª´ng hu·∫•n luy·ªán.
2025-10-16 16:45:18 - [INFO] - üèÅ Qu√° tr√¨nh hu·∫•n luy·ªán ho√†n t·∫•t.
2025-10-16 16:45:18 - [INFO] - Model t·ªët nh·∫•t v·ªõi Macro-F1 = 0.7491 ƒë√£ ƒë∆∞·ª£c l∆∞u t·∫°i '/home/guest/Projects/CS221/models/ernie-m-large-mnli-xnli-tuned'
2025-10-16 16:45:18 - [INFO] - Ph√¢n ph·ªëi k·∫øt qu·∫£ tr√™n t·ª´ng l·ªõp:
  true_label  correct  incorrect  total correct_rate incorrect_rate
0  extrinsic      329        132    461       71.37%         28.63%
1  intrinsic      318        172    490       64.90%         35.10%
2         no      389         60    449       86.64%         13.36%
